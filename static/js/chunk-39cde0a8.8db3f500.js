(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39cde0a8"],{7938:function(t,e,a){},a0df:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-position":"right","label-width":"120px"}},[a("sticky",{attrs:{"z-index":10,"class-name":"sub-navbar"}},[a("bar-space"),a("bar-cell",[a("el-button",{on:{click:t.goback}},[t._v("返回")])],1),a("bar-cell",[a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v(t._s(t.isEdit?"保存":"确认添加"))])],1)],1),a("div",{staticClass:"app-container"},[a("div",[a("h2",{staticClass:"text-black-40"},[t._v(" 考场管理 "),a("span",{staticClass:"text-gray-dark"},[t._v(t._s(t.SiteName))])]),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"考场编号",prop:"ERNumber"}},[a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.form.ERNumber,callback:function(e){t.$set(t.form,"ERNumber",e)},expression:"form.ERNumber"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"考场名称",prop:"ERName"}},[a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.form.ERName,callback:function(e){t.$set(t.form,"ERName",e)},expression:"form.ERName"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"考场类型",prop:"ERType"}},[t.isEdit?a("span",[t._v(t._s(t.form.ERType?"技能考场":"理论考场"))]):a("el-select",{staticClass:"width-full",attrs:{placeholder:"请选择"},model:{value:t.form.ERType,callback:function(e){t.$set(t.form,"ERType",e)},expression:"form.ERType"}},[a("el-option",{attrs:{label:"理论考场",value:0}}),a("el-option",{attrs:{label:"技能考场",value:1}})],1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"总考场位",prop:"SeatCount"}},[t.isEdit?a("span",[t._v(t._s(t.form.SeatCount))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.form.SeatCount,callback:function(e){t.$set(t.form,"SeatCount",t._n(e))},expression:"form.SeatCount"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"每行考位数",prop:"LineSeatCount"}},[t.isEdit?a("span",[t._v(t._s(t.form.LineSeatCount))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.form.LineSeatCount,callback:function(e){t.$set(t.form,"LineSeatCount",t._n(e))},expression:"form.LineSeatCount"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"预留考位",prop:"ReservedSeatCount"}},[t.isEdit?a("span",[t._v(t._s(t.form.ReservedSeatCount))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.form.ReservedSeatCount,callback:function(e){t.$set(t.form,"ReservedSeatCount",t._n(e))},expression:"form.ReservedSeatCount"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.Status,callback:function(e){t.$set(t.form,"Status",e)},expression:"form.Status"}})],1)],1),t.isEdit?t._e():a("el-col",{attrs:{span:16}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.doGenerate}},[t._v("生成初始座位图")])],1)],1)],1)],1),t.show?a("el-divider"):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("h2",{staticClass:"text-black-40"},[t._v("计算机座位图")]),a("p",[a("span",{staticClass:"text-red"},[t._v("注：")]),a("span",[a("span",{staticClass:"text-red"},[t._v("红色停用")]),t._v("：操作停用的考位; "),a("span",{staticClass:"text-green"},[t._v("绿色启用;")]),t._v(" 灰色禁用：设备信息异常，无法正常使用的考位。 ")])]),a("div",{attrs:{flex:"main:center"}},[a("div",{staticClass:"site-items",attrs:{flex:"dir:top"}},t._l(t.seatArray,(function(e,r){return a("div",{key:r,staticClass:"item",attrs:{flex:"main:right"}},[t._l(e,(function(e,r){return[99===e.Status?a("el-button",{key:r,staticClass:"btn-create-site",attrs:{size:"mini",type:"primary",plain:""},on:{click:t.openDialog}},[t._v("新增考位")]):a("el-dropdown",{key:r,staticClass:"site-dropdown",on:{command:function(a){return t.handleCommand(a,e)}}},[a("el-button",{attrs:{size:"mini",type:0===e.Status?"danger":1===e.Status?"success":"info",plain:""}},[a("span",{attrs:{flex:"cross:center"}},[a("span",{attrs:{flex:"cross:center dir:top"}},[1===e.SeatType?a("span",{staticClass:"text-blue"},[t._v("预约机"+t._s(e.Number))]):a("span",[t._v("考试机"+t._s(e.Number))]),0===e.Status?a("span",[t._v("停用")]):t._e(),2===e.Status?a("span",[t._v("禁用")]):t._e()]),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})])]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"edit"}},[t._v("改编号")]),0===e.Status?a("el-dropdown-item",{attrs:{command:"start"}},[t._v("启用")]):t._e(),1===e.Status?a("el-dropdown-item",{attrs:{command:"stop"}},[t._v("停用")]):t._e(),0===e.SeatType?a("el-dropdown-item",{attrs:{command:"setReserve"}},[t._v("设为预留机")]):t._e(),1===e.SeatType?a("el-dropdown-item",{attrs:{command:"setExam"}},[t._v("设为考试机")]):t._e()],1)],1)]}))],2)})),0)]),a("div",{attrs:{flex:"cross:center main:center"}},[a("div",{staticClass:"monitor-site",attrs:{flex:"cross:center"}},[t._v("监考座位")])])])],1),a("el-dialog",{attrs:{title:"新增座位",visible:t.dialogFormVisible,"before-close":t.dialogFormClose,"destroy-on-close":""},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dialogForm",attrs:{model:t.dialogForm,rules:t.dialogFormRules,"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"考位编号",prop:"Number"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.dialogForm.Number,callback:function(e){t.$set(t.dialogForm,"Number",e)},expression:"dialogForm.Number"}})],1),a("el-form-item",{attrs:{label:"考位类型",prop:"SeatType"}},[a("el-radio-group",{model:{value:t.dialogForm.SeatType,callback:function(e){t.$set(t.dialogForm,"SeatType",e)},expression:"dialogForm.SeatType"}},[a("el-radio-button",{attrs:{label:0}},[t._v("考试机")]),a("el-radio-button",{attrs:{label:1}},[t._v("预约机")])],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.createSite}},[t._v("确 定")])],1)],1)],1)},n=[],o=(a("4160"),a("a15b"),a("d81d"),a("fb6a"),a("45fc"),a("a434"),a("a9e3"),a("d3b7"),a("ac1f"),a("5319"),a("1276"),a("159b"),a("5530")),i=(a("96cf"),a("1da1")),s=a("bcb6"),u=a("61f7"),l={name:"DetailRoom",components:{BarCell:function(){return a.e("chunk-2d221e17").then(a.bind(null,"cbdf"))},BarSpace:function(){return a.e("chunk-2d2218de").then(a.bind(null,"cb9b"))},Sticky:function(){return a.e("chunk-2d210590").then(a.bind(null,"b804"))}},props:{isEdit:{type:Boolean,default:!1}},data:function(){var t=this,e=function(t,e,a){return Object(u["d"])(e)?a():a(new Error("须大于0的正整数"))},a=function(t,e,a){return Object(u["f"])(e)?a():a(new Error("须正整数"))},r=function(e,a,r){var n=t.form.SeatCount;return n&&n<a?r(new Error("不得超过总考位数 ".concat(n," 位"))):r()},n=function(t,e,a){return e&&e>14?a(new Error("每行最多14个座位")):a()},o=function(e,a,r){return a&&t.hasContain(a)?r(new Error("该编号已存在")):r()};return{show:!1,ERIID:0,SiteName:"新建",form:{ERNumber:"",ERName:"",ERType:"",LineSeatCount:"",SeatCount:"",ReservedSeatCount:"",Status:0,SiteID:0},formRules:{ERNumber:[{required:!0,message:"请输入考场编号",trigger:"blur"}],ERName:[{required:!0,message:"请输入考场名称",trigger:"blur"}],ERType:[{required:!0,message:"请选择考场类型",trigger:"change"}],SeatCount:[{required:!0,message:"请输入",trigger:"blur"},{validator:e,trigger:"blur"}],LineSeatCount:[{required:!0,message:"请填写",trigger:"blur"},{validator:e,trigger:"blur"},{validator:r,trigger:"blur"},{validator:n,trigger:"blur"}],ReservedSeatCount:[{required:!0,message:"请输入",trigger:"blur"},{validator:a,trigger:"blur"},{validator:r,trigger:"blur"}]},seatArray:[],defaultSeatList:[],dialogFormVisible:!1,dialogForm:{Number:"",SeatType:0},dialogFormRules:{Number:[{required:!0,message:"请输入考位编号",trigger:"blur"},{validator:o,trigger:"blur"}]}}},created:function(){if(this.isEdit){var t=this.$route.params&&this.$route.params.id;this.ERIID=Number(t),this.fetchData(Number(t))}},methods:{fetchData:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,u,l,c,m,d,f,p,b,S,g,v;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(s["i"])({ERIID:t});case 2:r=a.sent,r.success&&(n=r.response,i=n.SiteName,u=n.ERNumber,l=n.ERName,c=n.ERType,m=n.LineSeatCount,d=n.SeatCount,f=n.ReservedSeatCount,p=n.Status,b=n.SiteID,S=n.SeatList,e.SiteName=i,e.form={ERNumber:u,ERName:l,ERType:c,LineSeatCount:m,SeatCount:d,ReservedSeatCount:f,Status:p?1:0,SiteID:b},g=S.map((function(t,e){return Object(o["a"])(Object(o["a"])({},t),{},{index:e})})),g.push({Status:99}),e.defaultSeatList=JSON.parse(JSON.stringify(g)),v=e.getNewArray(g.reverse(),m),e.seatArray=v,e.show=!0);case 4:case"end":return a.stop()}}),a)})))()},goback:function(){this.$router.replace({name:"RoomIndex"})},getNewArray:function(t,e){var a=t.length%e,r=Math.ceil(t.length/e,10),n=0,o=0,i=[];a>0&&(n=1,o=a,i[0]=t.slice(0,a));while(n<r)i[n]=t.slice(o,e+o),o+=e,n++;return i},doGenerate:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.form.LineSeatCount,r=t.form.SeatCount,n=t.form.ReservedSeatCount,o=Array(r).join(",").split(",").map((function(e,a){var o=a+1,i=0;return o>r-n&&(i=1),{SeatLayoutID:0,Number:"".concat(t.numberStr(o)),SeatType:i,Status:2,ERIID:t.ERIID,index:o-1}}));t.defaultSeatList=JSON.parse(JSON.stringify(o)),t.seatArray=t.getNewArray(o.reverse(),a),t.show=!0}}))},numberStr:function(t){return t<10?"00".concat(t):t<100?"0".concat(t):"".concat(t)},dialogFormClose:function(){this.dialogFormVisible=!1,this.dialogForm={Number:"",SeatType:0}},openDialog:function(){this.dialogFormVisible=!0},createSite:function(){var t=this;this.$refs.dialogForm.validate((function(e){if(e){var a=t.defaultSeatList.length-1,r={SeatLayoutID:0,Number:"".concat(t.dialogForm.Number),SeatType:t.dialogForm.SeatType,Status:2,ERIID:t.ERIID,index:a};t.defaultSeatList.splice(a,0,r);var n=JSON.parse(JSON.stringify(t.defaultSeatList));t.seatArray=t.getNewArray(n.reverse(),t.form.LineSeatCount),t.dialogFormClose()}}))},handleCommand:function(t,e){var a=this;"edit"===t?this.$prompt("","修改编号",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return null===t||""===t?"不能为空":a.hasContain(t)?"该编号已存在":void 0}}).then((function(t){var r=t.value;e.Number=r,a.defaultSeatList[e.index].Number=r})):"start"===t?this.$confirm("确定启用该考位吗?启用后考试时将会安排考生到该考位,本考场也将增加可预约考位数量!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){e.Status=1,a.defaultSeatList[e.index].Status=1})):"stop"===t?this.$confirm("确定停用该考位吗?停用后考试时将不会安排考生到该考位,本考场也将减少可预约考位数量!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){e.Status=0,a.defaultSeatList[e.index].Status=0})):"setReserve"===t?this.$confirm("确定将该考位设置为预留机吗?设置后考试时将不会安排考生到该考位,本考场也将减少可预约考位数量!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){e.SeatType=1,a.defaultSeatList[e.index].SeatType=1,2!==e.Status&&(e.Status=0,a.defaultSeatList[e.index].Status=0)})):"setExam"===t&&this.$confirm("确定将该考位设置为考试机吗?设置后考试时将会安排考生到该考位,本考场也将增加可预约考位数量!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){e.SeatType=0,a.defaultSeatList[e.index].SeatType=0,2!==e.Status&&(e.Status=0,a.defaultSeatList[e.index].Status=0)}))},submitForm:function(){var t=this;this.defaultSeatList.length?this.$confirm("需要再确认一遍吗？","提示",{confirmButtonText:"不需要",cancelButtonText:"需要",type:"warning"}).then(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a){var r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=[],t.defaultSeatList.forEach((function(t){99!==t.Status&&r.push({SeatLayoutID:t.SeatLayoutID,ERIID:t.ERIID,Number:t.Number,SeatType:t.SeatType,Status:t.Status})})),n=Object(o["a"])(Object(o["a"])({},t.form),{},{SeatList:r,ERIID:t.ERIID}),console.log("data",r),e.next=6,Object(s["t"])(n);case 6:i=e.sent,i.success&&(t.$notify({title:"成功",message:i.msg,type:"success"}),t.goback());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):this.$message.error("请生成初始座位图")},hasContain:function(t){return this.defaultSeatList.some((function(e){return e.Number===t}))}}},c=l,m=(a("b1ca"),a("2877")),d=Object(m["a"])(c,r,n,!1,null,"6a866ce7",null);e["a"]=d.exports},b1ca:function(t,e,a){"use strict";var r=a("7938"),n=a.n(r);n.a},bcb6:function(t,e,a){"use strict";a.d(e,"m",(function(){return n})),a.d(e,"k",(function(){return o})),a.d(e,"r",(function(){return i})),a.d(e,"u",(function(){return s})),a.d(e,"a",(function(){return u})),a.d(e,"h",(function(){return l})),a.d(e,"q",(function(){return c})),a.d(e,"p",(function(){return m})),a.d(e,"l",(function(){return d})),a.d(e,"s",(function(){return f})),a.d(e,"v",(function(){return p})),a.d(e,"g",(function(){return b})),a.d(e,"i",(function(){return S})),a.d(e,"t",(function(){return g})),a.d(e,"f",(function(){return v})),a.d(e,"e",(function(){return h})),a.d(e,"d",(function(){return y})),a.d(e,"j",(function(){return R})),a.d(e,"n",(function(){return x})),a.d(e,"w",(function(){return E})),a.d(e,"o",(function(){return w})),a.d(e,"c",(function(){return C})),a.d(e,"b",(function(){return _}));var r=a("b775");function n(t){return Object(r["a"])({url:"/vue-admin-template/station-management/review-detail",method:"get",params:t})}function o(t){return Object(r["a"])({url:"api/station/GetSiteAuditInfos",method:"get",params:t})}function i(t){return Object(r["a"])({url:"api/station/LoadSiteAuditInfo",method:"get",params:t})}function s(t){return Object(r["a"])({url:"api/station/SaveSiteAuditInfo",method:"post",data:t})}function u(t){return Object(r["a"])({url:"api/station/DelSiteAuditInfo",method:"get",params:t})}function l(t){return Object(r["a"])({url:"api/station/GetGuidanceSiteAuditInfos",method:"get",params:t})}function c(t){return Object(r["a"])({url:"api/station/LoadGuidanceSiteAuditInfo",method:"get",params:t})}function m(t){return Object(r["a"])({url:"api/station/GuidanceAuditSiteInfo",method:"post",data:t})}function d(t){return Object(r["a"])({url:"api/station/GetSiteInfos",method:"get",params:t})}function f(t){return Object(r["a"])({url:"api/station/LoadSiteInfo",method:"get",params:t})}function p(t){return Object(r["a"])({url:"api/station/SaveSiteInfo",method:"post",data:t})}function b(t){return Object(r["a"])({url:"api/station/ExamRoomList",method:"get",params:t})}function S(t){return Object(r["a"])({url:"api/station/LoadExamRoom",method:"get",params:t})}function g(t){return Object(r["a"])({url:"api/station/SaveExamRoom",method:"post",data:t})}function v(t){return Object(r["a"])({url:"api/station/EnableExamRooms",method:"get",params:t})}function h(t){return Object(r["a"])({url:"api/station/DisableExamRooms",method:"get",params:t})}function y(t){return Object(r["a"])({url:"api/station/DelExamRooms",method:"get",params:t})}function R(t){return Object(r["a"])({url:"api/Station/GetNotAuthTrainingInstitutions",method:"get",params:t})}function x(t){return Object(r["a"])({url:"api/Station/GetTrainingInstitutionInfo",method:"get",params:t})}function E(t){return Object(r["a"])({url:"api/Station/SubTrainingInstitutionAuth",method:"post",data:t})}function w(t){return Object(r["a"])({url:"api/Station/GetTrainingInstitutions",method:"get",params:t})}function C(t){return Object(r["a"])({url:"api/Station/EnableTrainingInstitution",method:"post",data:t})}function _(t){return Object(r["a"])({url:"api/Station/DisableTrainingInstitution",method:"post",data:t})}}}]);